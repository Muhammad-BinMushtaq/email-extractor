<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìß Email Campaign Manager - Professional Email Marketing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --secondary: #f093fb;
            --accent: #4facfe;
            --success: #43e97b;
            --danger: #f5576c;
            --warning: #ff9800;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }

        /* ========== NAVBAR ========== */
        nav {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 1rem;
            background: var(--light);
            border-radius: 50px;
            cursor: pointer;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* ========== HERO SECTION ========== */
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 800;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.25rem;
            opacity: 0.95;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* ========== CONTAINER & LAYOUT ========== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .sidebar {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .sidebar-title {
            font-size: 0.9rem;
            color: var(--dark);
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sidebar-item {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark);
            border-left: 3px solid transparent;
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        /* ========== CARDS & COMPONENTS ========== */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card h2 {
            color: var(--dark);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        /* ========== FORMS & INPUTS ========== */
        .form-group {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        input, textarea, select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--light);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--light);
        }

        .btn-secondary:hover {
            background: transparent;
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 233, 123, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* ========== STATS & INFO ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        /* ========== MESSAGES ========== */
        .message {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
        }

        .message.active {
            display: block;
        }

        .message.success {
            background: rgba(67, 233, 123, 0.1);
            color: var(--success);
            border-left-color: var(--success);
        }

        .message.error {
            background: rgba(245, 87, 108, 0.1);
            color: var(--danger);
            border-left-color: var(--danger);
        }

        .message.info {
            background: rgba(79, 172, 254, 0.1);
            color: var(--accent);
            border-left-color: var(--accent);
        }

        @keyframes slideIn {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ========== TABLES ========== */
        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table thead {
            background: var(--light);
            border-bottom: 2px solid #e0e0e0;
        }

        table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
        }

        table td {
            padding: 1rem;
            border-bottom: 1px solid var(--light);
        }

        table tbody tr:hover {
            background: var(--light);
        }

        /* ========== PREMIUM BADGE ========== */
        .premium-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 1rem;
        }

        /* ========== SEARCH LIMIT INDICATOR ========== */
        .search-limit {
            background: var(--light);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--warning);
        }

        .limit-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .limit-fill {
            background: linear-gradient(90deg, var(--danger) 0%, var(--warning) 100%);
            height: 100%;
            transition: var(--transition);
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
                display: flex;
                gap: 1rem;
                flex-direction: row;
                overflow-x: auto;
                padding: 1rem;
            }

            .sidebar-menu {
                flex-direction: row;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .nav-links {
                gap: 1rem;
            }

            nav .container {
                flex-wrap: wrap;
            }
        }

        /* ========== LOADING ========== */
        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========== MODALS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .close-btn:hover {
            color: var(--dark);
        }
    </style>
</head>
<body>

<!-- ========== NAVBAR ========== -->
<nav>
    <div class="container">
        <div class="logo">üìß EmailPro</div>
        <div class="nav-links">
            <a onclick="switchTab('scrape')">Scraper</a>
            <a onclick="switchTab('compose')">Composer</a>
            <a onclick="switchTab('campaign')">Campaign</a>
        </div>
        <div class="nav-buttons">
            <button class="btn btn-primary" onclick="openPaymentModal()" style="min-width: 120px;">üí≥ Premium</button>
            <div class="user-profile" onclick="toggleUserMenu()">
                <div class="user-avatar" id="userInitial">G</div>
                <span id="userName">Guest</span>
            </div>
        </div>
    </div>
</nav>

<!-- ========== HERO SECTION ========== -->
<section class="hero">
    <div class="container">
        <h1>Professional Email Marketing Made Simple</h1>
        <p>Scrape emails, create campaigns, and reach your audience with powerful tools built for growth</p>
        <div class="hero-buttons">
            <button class="btn btn-primary" onclick="scrollToContent()">Get Started</button>
            <button class="btn btn-secondary" onclick="openGoogleAuth()"><i class="fab fa-google"></i> Sign in with Google</button>
        </div>
    </div>
</section>

<!-- ========== MAIN CONTENT ========== -->
<div class="container">
    <div class="main-content">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-title">Tools</div>
            <div class="sidebar-menu">
                <div class="sidebar-item active" onclick="switchTab('scrape')">
                    <i class="fas fa-search"></i> Scraper
                </div>
                <div class="sidebar-item" onclick="switchTab('compose')">
                    <i class="fas fa-pen"></i> Composer
                </div>
                <div class="sidebar-item" onclick="switchTab('campaign')">
                    <i class="fas fa-envelope"></i> Campaign
                </div>
                <div class="sidebar-item" onclick="switchTab('saved')">
                    <i class="fas fa-bookmark"></i> Saved
                </div>
            </div>
        </div>

        <!-- CONTENT -->
        <div class="content">
            <!-- SCRAPER TAB -->
            <div id="scrape" class="tab-pane active">
                <div class="card">
                    <h2><i class="fas fa-search"></i> Email Scraper</h2>
                    
                    <!-- Search Limit Indicator -->
                    <div class="search-limit" id="limitIndicator" style="display:none;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <strong>Daily Search Limit (Free)</strong>
                            <span id="limitText">0/3</span>
                        </div>
                        <div class="limit-bar">
                            <div class="limit-fill" id="limitFill" style="width: 0%;"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Website URL:</label>
                        <input type="url" id="urlInput" placeholder="https://example.com" value="https://example.com">
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="scrapeEmails()">
                            <i class="fas fa-search"></i> Scrape Emails
                        </button>
                    </div>

                    <div id="scrapeMsg" class="message"></div>
                    <div id="scrapeResults"></div>
                </div>
            </div>

            <!-- COMPOSER TAB -->
            <div id="compose" class="tab-pane" style="display:none;">
                <div class="card">
                    <h2><i class="fas fa-pen"></i> Email Composer</h2>
                    
                    <div class="form-group">
                        <label>Category:</label>
                        <select id="emailCategory" onchange="loadCategoryTemplate()">
                            <option value="">-- Select Category --</option>
                            <option value="principal">üéì Principal/Headmaster</option>
                            <option value="professor">üë®‚Äçüè´ Professor/Teacher</option>
                            <option value="university">üè´ University/Institution</option>
                            <option value="hr">üíº HR/Recruiter</option>
                            <option value="cto">üñ•Ô∏è CTO/Tech Lead</option>
                            <option value="investor">üí∞ Investor/VC</option>
                            <option value="client">ü§ù Business Client</option>
                            <option value="vendor">üì¶ Vendor/Supplier</option>
                            <option value="media">üì∞ Media/Press</option>
                        </select>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Recipient Name:</label>
                            <input type="text" id="recipientName" placeholder="e.g., Dr. Smith">
                        </div>
                        <div class="form-group">
                            <label>Purpose:</label>
                            <input type="text" id="composePurpose" placeholder="e.g., Partnership">
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateCategoryEmail()">
                            <i class="fas fa-magic"></i> Generate Email
                        </button>
                    </div>

                    <div id="composeMsg" class="message"></div>
                    <div id="composedEmail"></div>
                </div>
            </div>

            <!-- CAMPAIGN TAB -->
            <div id="campaign" class="tab-pane" style="display:none;">
                <div class="card">
                    <h2><i class="fas fa-envelope"></i> Send Campaign</h2>

                    <div class="form-group">
                        <label>Email Addresses (comma-separated):</label>
                        <textarea id="emailAddresses" placeholder="email1@example.com, email2@example.com"></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Subject:</label>
                            <input type="text" id="sendSubject" placeholder="Email subject">
                        </div>
                        <div class="form-group">
                            <label>Your Gmail:</label>
                            <input type="email" id="senderEmail" placeholder="your-email@gmail.com">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Email Body:</label>
                        <textarea id="sendBody" placeholder="Email content..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Gmail Password (App Specific):</label>
                        <input type="password" id="senderPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="sendEmails()">
                            <i class="fas fa-paper-plane"></i> Send Campaign
                        </button>
                    </div>

                    <div id="sendMsg" class="message"></div>
                </div>
            </div>

            <!-- SAVED TAB -->
            <div id="saved" class="tab-pane" style="display:none;">
                <div class="card">
                    <h2><i class="fas fa-bookmark"></i> Saved Drafts</h2>
                    <div id="savedEmailsList"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== PAYMENT MODAL ========== -->
<div id="paymentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üí≥ Upgrade to Premium</h2>
            <button class="close-btn" onclick="closePaymentModal()">√ó</button>
        </div>
        
        <div class="stats-grid" style="margin-bottom: 1.5rem;">
            <div class="stat-card">
                <div class="stat-value">‚àû</div>
                <div class="stat-label">Unlimited Scrapes</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">100+</div>
                <div class="stat-label">Emails/Month</div>
            </div>
        </div>

        <div class="form-group">
            <label>Transaction ID (EasyPaisa):</label>
            <input type="text" id="transactionId" placeholder="TXN123456789">
        </div>

        <div class="form-group">
            <label>Email Address:</label>
            <input type="email" id="paymentEmail" placeholder="your@email.com">
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="submitPayment()">
                <i class="fas fa-credit-card"></i> Pay Rs. 499
            </button>
            <button class="btn btn-secondary" onclick="closePaymentModal()">Cancel</button>
        </div>

        <div id="paymentMsg" class="message"></div>
    </div>
</div>

<!-- ========== ADMIN MODAL ========== -->
<div id="adminLoginModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üîê Admin Access</h2>
            <button class="close-btn" onclick="closeAdminModal()">√ó</button>
        </div>
        
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="verifyAdminPassword()">Login</button>
            <button class="btn btn-secondary" onclick="closeAdminModal()">Cancel</button>
        </div>

        <div id="adminLoginMsg" class="message"></div>
    </div>
</div>

<!-- ========== GOOGLE AUTH MODAL ========== -->
<div id="googleAuthModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fab fa-google"></i> Sign in with Google</h2>
            <button class="close-btn" onclick="closeGoogleAuth()">√ó</button>
        </div>
        
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="googleEmail" placeholder="your@gmail.com">
        </div>

        <div class="form-group">
            <label>Full Name:</label>
            <input type="text" id="googleName" placeholder="Your Name">
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="completeGoogleAuth()">Continue</button>
            <button class="btn btn-secondary" onclick="closeGoogleAuth()">Cancel</button>
        </div>

        <div id="googleAuthMsg" class="message"></div>
    </div>
</div>

<!-- ========== ADMIN DASHBOARD ========== -->
<div id="adminDashboard" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f5f7fa; z-index: 999; overflow-y: auto;">
    <div class="container" style="padding-top: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="color: var(--dark);">üîê Admin Dashboard</h1>
            <button class="btn btn-danger" onclick="logoutAdmin()">Logout</button>
        </div>

        <div class="stats-grid" style="margin-bottom: 2rem;">
            <div class="stat-card">
                <div class="stat-value" id="totalUsers">0</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendingPayments">0</div>
                <div class="stat-label">Pending Payments</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="approvedPayments">0</div>
                <div class="stat-label">Approved</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalRevenue">Rs. 0</div>
                <div class="stat-label">Total Revenue</div>
            </div>
        </div>

        <div class="card">
            <h2>Payment Requests</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Transaction ID</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsList"></tbody>
                </table>
            </div>
            <div id="noPayments" style="text-align: center; padding: 2rem; color: #999;">No payments yet</div>
        </div>
    </div>
</div>

<!-- ========== ADMIN BUTTON ========== -->
<button onclick="openAdminPanel()" style="position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; border: none; border-radius: 50%; font-size: 1.5rem; cursor: pointer; box-shadow: 0 5px 20px rgba(0,0,0,0.3); transition: var(--transition); z-index: 100;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
    üîê
</button>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
    // ========== INITIALIZATION ==========
    let currentUser = null;
    const ADMIN_PASSWORD = '123456';
    const FREE_SEARCH_LIMIT = 3;

    // Initialize on load
    window.addEventListener('load', function() {
        loadUserFromStorage();
        updateSearchLimitDisplay();
        if (localStorage.getItem('adminLoggedIn') === 'true') {
            loadAdminData();
        }
    });

    // ========== TAB SWITCHING ==========
    function switchTab(tab) {
        // Hide all tabs
        document.querySelectorAll('.tab-pane').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
        
        // Show selected tab
        document.getElementById(tab).style.display = 'block';
        event.target.classList.add('active');
    }

    // ========== GOOGLE AUTHENTICATION ==========
    function openGoogleAuth() {
        document.getElementById('googleAuthModal').classList.add('active');
    }

    function closeGoogleAuth() {
        document.getElementById('googleAuthModal').classList.remove('active');
        document.getElementById('googleEmail').value = '';
        document.getElementById('googleName').value = '';
    }

    function completeGoogleAuth() {
        const email = document.getElementById('googleEmail').value.trim();
        const name = document.getElementById('googleName').value.trim();

        if (!email || !name) {
            showMessage('googleAuthMsg', 'Please fill in all fields', 'error');
            return;
        }

        currentUser = {
            email: email,
            name: name,
            avatar: name.charAt(0).toUpperCase(),
            premium: false,
            searchesUsed: 0,
            loginDate: new Date().toLocaleString()
        };

        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        updateUserDisplay();
        closeGoogleAuth();
        showMessage('scrapeMsg', `‚úÖ Welcome ${name}! You have ${FREE_SEARCH_LIMIT} free searches.`, 'success');
    }

    // ========== USER MANAGEMENT ==========
    function loadUserFromStorage() {
        const user = localStorage.getItem('currentUser');
        if (user) {
            currentUser = JSON.parse(user);
            updateUserDisplay();
        }
    }

    function updateUserDisplay() {
        if (currentUser) {
            document.getElementById('userInitial').textContent = currentUser.avatar;
            document.getElementById('userName').textContent = currentUser.name.split(' ')[0];
            if (currentUser.premium) {
                document.getElementById('userName').innerHTML += ' <span class="premium-badge">PREMIUM</span>';
            }
        }
    }

    function toggleUserMenu() {
        alert(`User: ${currentUser ? currentUser.name : 'Not logged in'}\nStatus: ${currentUser && currentUser.premium ? 'Premium' : 'Free'}`);
    }

    function scrollToContent() {
        document.querySelector('.main-content').scrollIntoView({ behavior: 'smooth' });
    }

    // ========== SEARCH LIMIT MANAGEMENT ==========
    function updateSearchLimitDisplay() {
        if (!currentUser) {
            document.getElementById('limitIndicator').style.display = 'none';
            return;
        }

        document.getElementById('limitIndicator').style.display = 'block';
        const used = currentUser.searchesUsed || 0;
        const percentage = (used / FREE_SEARCH_LIMIT) * 100;
        document.getElementById('limitText').textContent = `${used}/${FREE_SEARCH_LIMIT}`;
        document.getElementById('limitFill').style.width = percentage + '%';
    }

    function checkSearchLimit() {
        if (!currentUser) {
            showMessage('scrapeMsg', 'Please sign in with Google first', 'error');
            return false;
        }

        if (!currentUser.premium && currentUser.searchesUsed >= FREE_SEARCH_LIMIT) {
            showMessage('scrapeMsg', `Free limit reached (${FREE_SEARCH_LIMIT}). Upgrade to Premium for unlimited searches.`, 'error');
            return false;
        }

        return true;
    }

    function incrementSearchCount() {
        if (currentUser && !currentUser.premium) {
            currentUser.searchesUsed = (currentUser.searchesUsed || 0) + 1;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateSearchLimitDisplay();
        }
    }

    // ========== EMAIL SCRAPING ==========
    async function scrapeEmails() {
        if (!checkSearchLimit()) return;

        const url = document.getElementById('urlInput').value.trim();
        if (!url) {
            showMessage('scrapeMsg', 'Please enter a valid URL', 'error');
            return;
        }

        showMessage('scrapeMsg', 'Scraping emails...', 'info');

        try {
            const response = await fetch('/api/scrape', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url })
            });

            const data = await response.json();

            if (!response.ok) throw new Error(data.error);

            incrementSearchCount();
            showMessage('scrapeMsg', `‚úÖ Found ${data.count} emails!`, 'success');
            
            // Display results
            const html = `
                <div style="margin-top: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">Found ${data.count} Emails:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                        ${data.emails.map(email => `
                            <div style="background: var(--light); padding: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <span>${email}</span>
                                <button onclick="navigator.clipboard.writeText('${email}')" class="btn btn-secondary" style="min-width: auto; padding: 0.5rem;">üìã</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            document.getElementById('scrapeResults').innerHTML = html;
        } catch (error) {
            showMessage('scrapeMsg', 'Error: ' + error.message, 'error');
        }
    }

    // ========== EMAIL TEMPLATES ==========
    const emailTemplates = {
        principal: "Dear Dr. [NAME],\n\nI hope this message finds you well. I am writing to express my interest in [PURPOSE] at your esteemed institution.\n\nWith my background and passion for education, I believe I can contribute significantly to your school's mission and help students achieve their potential.\n\nI would appreciate the opportunity to discuss this further. Would you have time for a brief conversation?\n\nThank you for considering my request.\n\nBest regards,\n[Your Name]",
        
        professor: "Dear Prof. [NAME],\n\nI hope you are well. I am writing regarding [PURPOSE].\n\nYour groundbreaking work in this field has deeply inspired my academic and professional journey. I greatly admire your contributions and would be honored to discuss potential collaboration or mentorship opportunities.\n\nWould you be available for a discussion at your convenience?\n\nThank you for considering my request.\n\nBest regards,\n[Your Name]",
        
        university: "Dear Admissions Team,\n\nI am writing to express my strong interest in [PURPOSE] with your institution.\n\nYour university's commitment to excellence and innovation aligns perfectly with my academic goals and values. I am confident that I can make meaningful contributions to your academic community.\n\nI would welcome the opportunity to discuss how I can support your institution's mission.\n\nThank you for your consideration.\n\nBest regards,\n[Your Name]",
        
        hr: "Dear [NAME],\n\nI hope this email finds you in good health. I am writing to express my interest in [PURPOSE] at your esteemed organization.\n\nWith [NUMBER] years of experience in my field, I have developed strong skills in leadership, problem-solving, and team collaboration. I am confident that these skills will enable me to make significant contributions to your team.\n\nI would appreciate the opportunity to discuss how my background aligns with your needs.\n\nBest regards,\n[Your Name]",
        
        cto: "Dear [NAME],\n\nI hope you're having a great day. I'm reaching out regarding [PURPOSE].\n\nI have extensive experience with cutting-edge technologies and have successfully led teams to deliver innovative solutions. I believe my technical expertise and strategic vision could add significant value to your organization.\n\nWould you be open to a conversation about potential opportunities?\n\nBest regards,\n[Your Name]",
        
        investor: "Dear [NAME],\n\nI am reaching out regarding an exciting opportunity for [PURPOSE].\n\nOur business model has demonstrated strong market potential with [KEY METRICS]. We are seeking investors who share our vision for growth and innovation.\n\nI would love to schedule a brief call to discuss how this opportunity aligns with your investment portfolio.\n\nBest regards,\n[Your Name]",
        
        client: "Dear [NAME],\n\nI hope you're doing well. I am writing to propose [PURPOSE] that I believe could benefit your organization.\n\nBased on my understanding of your business, I have identified several opportunities where our solutions can drive measurable value. I would be delighted to discuss how we can partner for mutual success.\n\nWould you have time for a brief meeting?\n\nBest regards,\n[Your Name]",
        
        vendor: "Dear [NAME],\n\nI am reaching out regarding [PURPOSE] between our companies.\n\nWe specialize in providing high-quality [PRODUCT/SERVICE] that has consistently delivered excellent results for our partners. I believe our offerings could be mutually beneficial for our organizations.\n\nI would welcome the opportunity to discuss potential collaboration.\n\nBest regards,\n[Your Name]",
        
        media: "Dear [NAME],\n\nI am writing to share an exciting story about [PURPOSE] that I believe would be of great interest to your readers/audience.\n\nThis initiative showcases innovation and positive impact in our industry. I would be delighted to provide more details, schedule an interview, or facilitate a site visit.\n\nPlease let me know if you would like to explore this further.\n\nBest regards,\n[Your Name]"
    };

    function loadCategoryTemplate() {
        const category = document.getElementById('emailCategory').value;
        if (category && emailTemplates[category]) {
            showMessage('composeMsg', `‚úÖ Template loaded for ${category}. Fill in the details to customize.`, 'success');
        }
    }

    function generateCategoryEmail() {
        const category = document.getElementById('emailCategory').value;
        const recipientName = document.getElementById('recipientName').value.trim();
        const purpose = document.getElementById('composePurpose').value.trim();

        if (!category) {
            showMessage('composeMsg', 'Please select a category', 'error');
            return;
        }

        if (!recipientName || !purpose) {
            showMessage('composeMsg', 'Please fill in all fields', 'error');
            return;
        }

        let template = emailTemplates[category];
        let subject = '';

        // Generate subject based on category and purpose
        switch(category) {
            case 'principal':
                subject = `Inquiry Regarding ${purpose} - Professional Request`;
                break;
            case 'professor':
                subject = `${purpose} Opportunity - Academic Discussion`;
                break;
            case 'university':
                subject = `Application for ${purpose}`;
                break;
            case 'hr':
                subject = `Application for ${purpose}`;
                break;
            case 'cto':
                subject = `${purpose} - Technical Opportunity`;
                break;
            case 'investor':
                subject = `Investment Opportunity: ${purpose}`;
                break;
            case 'client':
                subject = `Proposal for ${purpose}`;
                break;
            case 'vendor':
                subject = `Partnership Opportunity: ${purpose}`;
                break;
            case 'media':
                subject = `Story Pitch: ${purpose}`;
                break;
            default:
                subject = `Regarding ${purpose}`;
        }

        // Replace placeholders
        let emailBody = template
            .replace(/\[NAME\]/g, recipientName)
            .replace(/\[PURPOSE\]/g, purpose)
            .replace(/\[NUMBER\]/g, '5+')
            .replace(/\[KEY METRICS\]/g, 'strong growth metrics')
            .replace(/\[PRODUCT\/SERVICE\]/g, 'premium solutions');

        const html = `
            <div style="background: var(--light); padding: 1.5rem; border-radius: 8px; margin-top: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Generated Email</h3>
                    <button onclick="copyCEmail('${btoa(emailBody)}')" class="btn btn-secondary" style="min-width: auto;">üìã Copy</button>
                </div>
                <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <strong style="color: var(--dark);">Subject:</strong> ${subject}
                </div>
                <div style="background: white; padding: 1rem; border-radius: 8px; white-space: pre-wrap; line-height: 1.6; color: var(--dark); max-height: 300px; overflow-y: auto; border: 1px solid var(--light);">
                    ${emailBody}
                </div>
                <div class="btn-group" style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="copyToSend('${subject}', '${btoa(emailBody)}')">Use in Campaign</button>
                    <button class="btn btn-secondary" onclick="saveEmailDraft('${subject}', '${btoa(emailBody)}')">Save Draft</button>
                </div>
            </div>
        `;

        document.getElementById('composedEmail').innerHTML = html;
        showMessage('composeMsg', '‚úÖ Email generated successfully!', 'success');
    }

    function copyCEmail(encodedEmail) {
        const email = atob(encodedEmail);
        navigator.clipboard.writeText(email);
        showMessage('composeMsg', '‚úÖ Email copied to clipboard!', 'success');
    }

    function copyToSend(subject, encodedBody) {
        document.getElementById('sendSubject').value = subject;
        document.getElementById('sendBody').value = atob(encodedBody);
        switchTab('campaign');
        showMessage('sendMsg', '‚úÖ Email copied to campaign. Ready to send!', 'success');
    }

    function saveEmailDraft(subject, encodedBody) {
        const drafts = JSON.parse(localStorage.getItem('emailDrafts') || '[]');
        const draft = {
            id: Date.now(),
            subject: subject,
            body: atob(encodedBody),
            saved: new Date().toLocaleString()
        };
        drafts.push(draft);
        localStorage.setItem('emailDrafts', JSON.stringify(drafts));
        showMessage('composeMsg', '‚úÖ Draft saved! Check Saved tab to view.', 'success');
        loadSavedEmails();
    }

    function loadSavedEmails() {
        const drafts = JSON.parse(localStorage.getItem('emailDrafts') || '[]');
        const savedDiv = document.getElementById('savedEmailsList');

        if (drafts.length === 0) {
            savedDiv.innerHTML = '<p style="text-align: center; color: #999;">No saved drafts yet</p>';
            return;
        }

        const html = `
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>Saved Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${drafts.map(draft => `
                            <tr>
                                <td>${draft.subject}</td>
                                <td>${draft.saved}</td>
                                <td>
                                    <button onclick="useSavedDraft(${draft.id})" class="btn btn-primary" style="padding: 0.5rem; min-width: auto;">Use</button>
                                    <button onclick="deleteSavedDraft(${draft.id})" class="btn btn-danger" style="padding: 0.5rem; min-width: auto;">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
        savedDiv.innerHTML = html;
    }

    function useSavedDraft(id) {
        const drafts = JSON.parse(localStorage.getItem('emailDrafts') || '[]');
        const draft = drafts.find(d => d.id === id);
        if (draft) {
            document.getElementById('sendSubject').value = draft.subject;
            document.getElementById('sendBody').value = draft.body;
            switchTab('campaign');
        }
    }

    function deleteSavedDraft(id) {
        if (confirm('Delete this draft?')) {
            let drafts = JSON.parse(localStorage.getItem('emailDrafts') || '[]');
            drafts = drafts.filter(d => d.id !== id);
            localStorage.setItem('emailDrafts', JSON.stringify(drafts));
            loadSavedEmails();
        }
    }

    // ========== EMAIL SENDING ==========
    async function sendEmails() {
        const emails = document.getElementById('emailAddresses').value.trim();
        const subject = document.getElementById('sendSubject').value.trim();
        const body = document.getElementById('sendBody').value.trim();
        const senderEmail = document.getElementById('senderEmail').value.trim();
        const senderPassword = document.getElementById('senderPassword').value.trim();

        if (!emails || !subject || !body || !senderEmail || !senderPassword) {
            showMessage('sendMsg', 'Please fill in all fields', 'error');
            return;
        }

        showMessage('sendMsg', 'Sending emails...', 'info');

        try {
            const emailList = emails.split(',').map(e => e.trim()).filter(e => e);
            
            const response = await fetch('/api/send-email', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    emailAddresses: emailList,
                    subject: subject,
                    emailBody: body,
                    senderEmail: senderEmail,
                    senderPassword: senderPassword
                })
            });

            const data = await response.json();

            if (!response.ok) throw new Error(data.error);

            showMessage('sendMsg', `‚úÖ Campaign sent! ${data.totalSent} sent, ${data.totalFailed} failed.`, 'success');
        } catch (error) {
            showMessage('sendMsg', 'Error: ' + error.message, 'error');
        }
    }

    // ========== PAYMENT SYSTEM ==========
    function openPaymentModal() {
        document.getElementById('paymentModal').classList.add('active');
    }

    function closePaymentModal() {
        document.getElementById('paymentModal').classList.remove('active');
    }

    function submitPayment() {
        const transactionId = document.getElementById('transactionId').value.trim();
        const email = document.getElementById('paymentEmail').value.trim();

        if (!transactionId || !email) {
            showMessage('paymentMsg', 'Please fill in all fields', 'error');
            return;
        }

        const payment = {
            id: Date.now(),
            email: email,
            transactionId: transactionId,
            amount: 499,
            status: 'pending',
            date: new Date().toLocaleString(),
            currency: 'PKR'
        };

        let payments = JSON.parse(localStorage.getItem('payments') || '[]');
        payments.push(payment);
        localStorage.setItem('payments', JSON.stringify(payments));

        if (currentUser && currentUser.email === email) {
            currentUser.premium = false; // Will be true after approval
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
        }

        showMessage('paymentMsg', '‚úÖ Payment submitted! Waiting for approval...', 'success');
        setTimeout(() => {
            closePaymentModal();
            alert('Payment recorded. Admin will confirm within 24 hours.');
            document.getElementById('transactionId').value = '';
            document.getElementById('paymentEmail').value = '';
        }, 1500);
    }

    // ========== ADMIN SYSTEM ==========
    function openAdminPanel() {
        if (localStorage.getItem('adminLoggedIn') === 'true') {
            document.getElementById('adminDashboard').style.display = 'block';
            loadAdminData();
        } else {
            document.getElementById('adminLoginModal').classList.add('active');
        }
    }

    function closeAdminModal() {
        document.getElementById('adminLoginModal').classList.remove('active');
    }

    function verifyAdminPassword() {
        const password = document.getElementById('adminPassword').value;
        
        if (password === ADMIN_PASSWORD) {
            localStorage.setItem('adminLoggedIn', 'true');
            document.getElementById('adminLoginModal').classList.remove('active');
            document.getElementById('adminDashboard').style.display = 'block';
            loadAdminData();
            document.getElementById('adminPassword').value = '';
        } else {
            showMessage('adminLoginMsg', '‚ùå Incorrect password', 'error');
        }
    }

    function logoutAdmin() {
        localStorage.setItem('adminLoggedIn', 'false');
        document.getElementById('adminDashboard').style.display = 'none';
        alert('Logged out');
    }

    function loadAdminData() {
        let payments = JSON.parse(localStorage.getItem('payments') || '[]');
        let users = new Set(payments.map(p => p.email)).size;
        let pending = payments.filter(p => p.status === 'pending').length;
        let approved = payments.filter(p => p.status === 'approved').length;
        let revenue = payments.filter(p => p.status === 'approved').reduce((sum, p) => sum + p.amount, 0);

        document.getElementById('totalUsers').textContent = users;
        document.getElementById('pendingPayments').textContent = pending;
        document.getElementById('approvedPayments').textContent = approved;
        document.getElementById('totalRevenue').textContent = 'Rs. ' + revenue.toLocaleString();

        const paymentsList = document.getElementById('paymentsList');
        paymentsList.innerHTML = '';

        if (payments.length === 0) {
            document.getElementById('noPayments').style.display = 'block';
            return;
        }

        document.getElementById('noPayments').style.display = 'none';

        payments.forEach(p => {
            const statusColor = p.status === 'pending' ? '#ff9800' : p.status === 'approved' ? '#43e97b' : '#f5576c';
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${p.email}</td>
                <td>${p.transactionId}</td>
                <td>Rs. ${p.amount}</td>
                <td>${p.date}</td>
                <td style="color: ${statusColor}; font-weight: bold;">${p.status.toUpperCase()}</td>
                <td>
                    ${p.status === 'pending' ? `
                        <button onclick="approvePayment(${p.id})" class="btn btn-success" style="padding: 0.5rem;">‚úì</button>
                        <button onclick="rejectPayment(${p.id})" class="btn btn-danger" style="padding: 0.5rem;">‚úï</button>
                    ` : 'Processed'}
                </td>
            `;
            paymentsList.appendChild(row);
        });
    }

    function approvePayment(id) {
        let payments = JSON.parse(localStorage.getItem('payments') || '[]');
        payments = payments.map(p => {
            if (p.id === id) p.status = 'approved';
            return p;
        });
        localStorage.setItem('payments', JSON.stringify(payments));

        // Mark user as premium if logged in
        if (currentUser && payments.find(p => p.id === id && p.email === currentUser.email)) {
            currentUser.premium = true;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateUserDisplay();
        }

        loadAdminData();
        alert('‚úÖ Payment approved!');
    }

    function rejectPayment(id) {
        let payments = JSON.parse(localStorage.getItem('payments') || '[]');
        payments = payments.map(p => {
            if (p.id === id) p.status = 'rejected';
            return p;
        });
        localStorage.setItem('payments', JSON.stringify(payments));
        loadAdminData();
        alert('‚ùå Payment rejected!');
    }

    // ========== UTILITY FUNCTIONS ==========
    function showMessage(elementId, message, type) {
        const msg = document.getElementById(elementId);
        msg.textContent = message;
        msg.classList.add('active', type);
        setTimeout(() => msg.classList.remove('active'), 3000);
    }
</script>

</body>
</html>
